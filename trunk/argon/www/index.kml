<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://earth.google.com/kml/2.1">
<Document>  
  <Style id="documentStyle">
    <IconStyle>
      <Icon>
        <href>http://www.iconspedia.com/uploads/1912642692.png</href>
      </Icon>
    </IconStyle>
  </Style>
  
  <Style id="overlayStyle"> <!-- style for ScreenOverlay -->
    <BalloonStyle>
      <displayMode>undecorated</displayMode>
    </BalloonStyle>
  </Style>
  
  <Style id="flickrStyle"> <!-- style for placemarkers -->
    <IconStyle>
      <scale>1.0</scale>
      <Icon>
        <href>http://www.iconspedia.com/uploads/1912642692.png</href> <!-- url to twitter logo -->
      </Icon>
      <hotSpot x="0.5" y="0" xunits="fraction" yunits="fraction" />
    </IconStyle>
  </Style>
  <ScreenOverlay>
    <name>myOverlay</name>
      <description><![CDATA[
     
      <style type="text/css">
      *{margin:0; padding:0; font-size:9px;}
      #product-list{
        position: absolute;
        top: -11px;
        left: -5px; 
        color: #333;
        font-size: 10px;
      } 
      #product-list li  {
  border-bottom: 1px solid #CCC;
  position: relative;
  list-style: none;
  width: 322px;
  height: 50px;
  font-family:'Myriad Pro',tahoma;  
  text-decoration:none;  
  font-size:13px;  
 background-color:white;
}
#product-list li > * {  position: absolute; overflow: hidden; height:20px;}

#product-list li img{
  top: 5px;
  left: 5px;
  max-width: 80px;
  max-height: 80px;
}
#product-list li span.name {
  top:5px;
  left: 60px;
  width: 160px;
  font-weight: bold;
  
}
#product-list li span.manufacturer {
  top:22px;
  left: 60px;
  width: 100px;
  font-family: cursive;
  font-size: 10px;
  font-style: italic;
  text-indent: 5px;
}
#product-list li span.price {
  top:5px;
  right: 30px;
  width: 70px;
  font-family: monospace;
  text-align: right;
}

#product-list li span.shop {
  top: 25px;
  right: 30px;
  width: 120px;
  text-align: right;
  font-weight:500;
  padding-right: 5px;
}

#product-list li a {
  background: url("next.png") no-repeat center;
  height: 15px;
  width: 16px;
  top:16px;
  right: 5px;
}
      </style>
      
      <ul id="product-list">
        <li>test</li>
        <li>item</li>
      </ul>
      
      <script type="text/javascript">
        var productList = document.getElementById('product-list');
        var rootUrl  = "http://www.fabienrenaud.com/zap/argon/www";
        var shops    = {};
        
        var fetchProducts = function() {          
          $(productList).empty();
          
          var myLoc = KHARMA.getLocation();
          var lat = 49.116846;
          var lng = 6.178501;
          $.getJSON(rootUrl + "/getShops.php", { lat:lat, lng:lng }, function(data) {
            $.each(data, function(i, item) {
              var url = item.webServiceUrl;
              var uid = item.publicUid;
              var shopName = item.name; 
              var currency = item.currency;
              $.getJSON(url, {publicUid:uid}, function(data) {
                $.each(data,function(i, item) {
                  
                  var span1 = document.createElement("span");
                      span1.setAttribute("class", "name");
                      span1.appendChild(document.createTextNode(item.name));
                  var span2 = document.createElement("span");
                      span2.setAttribute("class", "price");
                      span2.appendChild(document.createTextNode(item.price + currency));
                  var span3 = document.createElement("span");
                      span3.setAttribute("class", "manufacturer");
                      span3.appendChild(document.createTextNode(item.manufacturer));
                  var span4 = document.createElement("span");
                      span4.setAttribute("class", "shop");
                      span4.appendChild(document.createTextNode(shopName));
                  var a = document.createElement("a");
                      a.setAttribute('href', '#');
                  var image = document.createElement("img");
                      image.setAttribute("src", item.picture);
                  var li = document.createElement("li");
                      li.appendChild(span1);
                      li.appendChild(span2);
                      li.appendChild(span3);
                      li.appendChild(span4);
                      li.appendChild(a);
                      li.appendChild(image);
                  productList.appendChild(li);
                });
              });
            });
          });
        };
        
        
        $(document).ready(function() {
          fetchProducts();
        });
      </script>
    ]]></description>
      
    <overlayXY x="0.5" y="0.5" xunits="fraction" yunits="fraction"/> 
    <screenXY x="0.01" y="1.0" xunits="fraction" yunits="fraction"/>
    <size x="0" y="0" xunits="pixels" yunits="pixels"/>
    
    <styleUrl>#overlayStyle</styleUrl>  
  
  </ScreenOverlay>
  
  <styleUrl>#documentStyle</styleUrl> 
  
  <!-- KML document description -->
  <name>Zap</name>
  <Snippet>Zap for Argon</Snippet>
  <description><![CDATA[
    <div><p><b>Zap for Argon</b></p>
    <p>
    <b>notes:</b>
    <ul>
    <li>Searches for geo-tagged Flickr photos within 5km of user's current location
    <li>Displays photos as icons within the AR browser's viewing space
    <li>Click on icons to view larger photo<br>
    <li>The javascript functions use JQuery to retrieve JSON data from a Flickr search built within the Yahoo Pipes framework
    <li>The pipes JSON data is then used to create new JSON placemark objects that are then turned into new KML placemarks
    <li>Once the kml placemarks have been rendered in the display, the user may begin interacting with them
    </ul>
  ]]></description>   
  
</Document>
</kml>