<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.2.min.js"></script>
    <link href="test.css" type="text/css" rel="stylesheet"/>
  </head>
  <body>
    <ul id="product-list">
      <!--      <li> <img src="footwear.jpg" /> 
            <span class="name"> Foot Wear </span>
              <span class="price"> 39,99 € </span> 
              <span class="manufacturer"> Adidas </span>
              <span class="shop"> Your Sport </span>
            <a href="#" ></a>  </li>-->
    </ul>
   <div id="product-details">
<!--          <div>
    
            <a id="header" href="#">Shop Info </a>
            
            <div class="main">
              <img src="footwear.jpg" /> 
              <span class="name"> Foot Wear </span>
              <span class="price"> 39,99 € </span> 
              <span class="manufacturer"> Adidas </span>
              <h4>Description </h4> 
              <p>Offers maximum grip in all directions, 
                optimal ground penetration for maximum grip, larger surface area
                for greater acceleration, and better pressure distribution for 
              increased comfort.</p>
                
              <span class="category"> Category: Sport</span>
              <span class="productType"> Type: Sport Wear </span>
              <table class="detailsType">
                <tr>
                  <td> available sizes</td>
                  <td> 37-45 </td>
                </tr>
                <tr>  
                  <td>  category      </td>
                  <td> professional</td>
                </tr>
              </table>
            </div>
            <a id="footer" href="#">Go To Shop </a>
          </div>-->
        </div>
    
    <script type="text/javascript">
      var productList = document.getElementById('product-list');
      var productDetails = document.getElementById('product-details');
      var rootUrl  = "http://www.fabienrenaud.com/zap/argon/www";
      var shops    = {};
        
      var removePlacemarkers = function () {
        for (kmlObjId in KHARMA.dom.elements) {
          var kmlObj = KHARMA.dom.elements[kmlObjId];
          var feature = document.getElementById(kmlObj.id);
          if (feature && kmlObjId.substring(0,2) == 'PM') {
            //var distance = $(feature).data("distance");
            //console.log("***** " + distance);
            $(feature).remove();
            KHARMA.dom.removeElementWithID(kmlObj.id);
          }
        }
      };
        
      var fetchProducts = function() {
        // removePlacemarkers();
        $(productList).empty();
          
        var lat = 49.116846;
        var lng = 6.178501;
        $.getJSON(rootUrl + "/getShops.php", { lat:lat, lng:lng }, function(data) {
          $(data).each(function(i, item) {
            var url = item.webServiceUrl;
            var uid = item.publicUid;
            var shopName = item.name; 
            var currency = item.currency;
            $.getJSON(url, {publicUid:uid}, function(data) {
              $(data).each(function(i, item) {
                  
                var span1 = document.createElement("span");
                span1.setAttribute("class", "name");
                span1.appendChild(document.createTextNode(item.name));
                var span2 = document.createElement("span");
                span2.setAttribute("class", "price");
                span2.appendChild(document.createTextNode(item.price + currency));
                var span3 = document.createElement("span");
                span3.setAttribute("class", "manufacturer");
                span3.appendChild(document.createTextNode(item.manufacturer));
                var span4 = document.createElement("span");
                span4.setAttribute("class", "shop");
                span4.appendChild(document.createTextNode(shopName));
                var a = document.createElement("a");
                a.setAttribute('href', '#');
                $(a).click(function(){productInfo(item.name,item.picture,item.manufacturer,item.price + currency,
                  shopName,item.description,item.category,item.type,item.details)});
                var image = document.createElement("img");
                image.setAttribute("src", item.picture);
                var li = document.createElement("li");
                li.appendChild(span1);
                li.appendChild(span2);
                li.appendChild(span3);
                li.appendChild(span4);
                li.appendChild(a);
                li.appendChild(image);
                productList.appendChild(li);
              });
            });
          });
        });
      };
        
      var productInfo = function(name,image,manufacturer,price,shop,description,category,productType,details){
        var header = document.createElement("a");
        header.setAttribute("id", "header");
        header.setAttribute("href", "#");
        header.appendChild(document.createTextNode("Shop Info"));
        var footer = document.createElement("a");
        footer.setAttribute("id", "footer");
        footer.setAttribute("href", "#");
        footer.appendChild(document.createTextNode("Go To Shop"));
        var img = document.createElement("img");
        img.setAttribute("src", image)
        var span1 = document.createElement("span");
        span1.setAttribute("class", "name");
        span1.appendChild(document.createTextNode(name));
        var span2 = document.createElement("span");
        span2.setAttribute("class", "price");
        span2.appendChild(document.createTextNode(price));
        var span3 = document.createElement("span");
        span3.setAttribute("class", "manufacturer");
        span3.appendChild(document.createTextNode(manufacturer));
        var span4 =document.createElement("span");
        span4.setAttribute("class", "category");
        span4.appendChild(document.createTextNode("Category:"+category));
        span4.appendChild(document.createElement("br"));
        span4.appendChild(document.createTextNode("Type:"+productType));
        var h4 = document.createElement("h4");
        h4.appendChild(document.createTextNode("Description"));
        var p = document.createElement("p");
        p.appendChild(document.createTextNode(description));
        var table = document.createElement("table");
        table.setAttribute("class", "detailsType");
        $(details).each(function(i,detail){
          var td1 = document.createElement("td");
          td1.appendChild(document.createTextNode(detail.name));
          var td2 = document.createElement("td");
          td2.appendChild(document.createTextNode(detail.value));
          var tr = document.createElement("tr");
          tr.appendChild(td1);
          tr.appendChild(td2);
          table.appendChild(tr);
        })
        var div3 = document.createElement("div");
        div3.setAttribute("class", "main");
        div3.appendChild(img);
        div3.appendChild(span1);
        div3.appendChild(span2);
        div3.appendChild(span3);
        div3.appendChild(span4);
        div3.appendChild(span5);
        div3.appendChild(h4);
        div3.appendChild(p);
        div3.appendChild(table);
        var div2 = document.createElement("div");
        div2.appendChild(header);
        div2.appendChild(div3);
        div2.appendChild(footer);
        
    $(productDetails).empty();
        productDetails.appendChild(div2);

      }
        
      fetchProducts();
    </script>



  </body>
</html>